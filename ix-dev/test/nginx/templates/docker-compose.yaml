services:
  {{ ix_lib.base.test.container_name() }}:
    image: nginx
    ports:
      - {{ values.network.web_port }}:80
    depends_on:
      perms:
        condition: service_completed_successfully
    healthcheck:
      test: "curl --fail --silent http://localhost:80"
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 30s
  perms:
    image: bash
    user: root
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512m
    entrypoint:
      - bash
      - -c
    command:
      - |
        echo "I'm simulating permissions..."
        sleep 10
        echo "Done simulating permissions"
        exit 0
